!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AmxIndexedDB=t()}(this,function(){"use strict";class e{constructor(e){this.V=e.v,this.dbName=e.db,this.dbData=e.dbData}open(){return window.indexedDB||window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available."),new Promise((e,t)=>{let n=window.indexedDB.open(this.dbName,this.V);n.onsuccess=t=>{this.db=n.result,e(!1)},n.onerror=e=>{t(e)},n.onupgradeneeded=t=>{this.db=t.target.result;for(let n in this.dbData)if(!this.db.objectStoreNames.contains(n)){this.db.createObjectStore(n,{keyPath:"key"}).transaction.oncomplete=t=>{e(!0)}}}})}addData(e,t){return new Promise((n,r)=>{try{var o=this.db.transaction([e],"readwrite").objectStore(e).add(t);o.onsuccess=e=>{n(e)},o.onerror=e=>{r(e)}}catch(a){console.log(a),r(!1)}})}read(e,t){return new Promise((n,r)=>{try{var o=this.db.transaction([e]).objectStore(e).get(t);o.onsuccess=e=>{n(o)},o.onerror=e=>{r(e)}}catch(a){console.log(a),r(!1)}})}readAll(e,t){return new Promise((n,r)=>{try{var o=this.db.transaction(t).objectStore(t),a=[];o.openCursor(e).onsuccess=e=>{let t=e.target.result;t?(a.push(t.value),t.continue()):n(a)}}catch(c){console.log(c),r(!1)}})}update(e,t){return new Promise((n,r)=>{try{var o=this.db.transaction([e],"readwrite").objectStore(e).put(t);o.onsuccess=e=>{n(e)},o.onerror=e=>{r(e)}}catch(a){console.log(a),r(!1)}})}remove(e,t){return new Promise((n,r)=>{try{var o=this.db.transaction([e],"readwrite").objectStore(e).delete(t);o.onsuccess=e=>{n(e)},o.onerror=e=>{r(e)}}catch(a){console.log(a),r(!1)}})}allLength(e){return new Promise((t,n)=>{try{var r=this.db.transaction([e],"readonly").objectStore(e).count();r.onsuccess=()=>{t(r.result)},r.onerror=e=>{n(e)}}catch(o){console.log(o),n(!1)}})}}var t,n={exports:{}};const r={};let o,a=new((t||(t=1,window,n.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/lib",n(n.s=0)}([function(e,t,n){n.r(t);let r=function(){this.height=window.screen.availHeight};r.prototype.binding=function(e,t,n){let r=document.getElementsByClassName(e),o=window.screen.availHeight;window.onscroll=function(){for(let e=0;e<r.length;e++)r[e].getBoundingClientRect().top<o&&r[e].getBoundingClientRect().top>0?t():n()}};var o=r;const a=e=>e.toString().replace(/(?=(\B)(\d{3})+$)/g,",");function c(e,t){for(let n in e)if(-1==t.indexOf(e[n]))return!1;return!0}function s(e,t){const n=new Set(t);for(let r in e)if(0==n.has(e[r]))return!1;return!0}function u(e,t){return-1!=e.indexOf(t)&&e.splice(e.findIndex(e=>e==t),1)}function i(e){var t=e.length;if(t<2)return e;var n=Math.floor(t/2),r=e.slice(0,n),o=e.slice(n);return function(e,t){for(var n=[];e.length>0&&t.length>0;)e[0]<=t[0]?n.push(e.shift()):n.push(t.shift());for(;e.length;)n.push(e.shift());for(;t.length;)n.push(t.shift());return n}(mergeSort(r),mergeSort(o))}function l(e){let t,n;for(let r=1;r<e.length;r++){for(t=e[r],n=r-1;n>-1&&e[n]>t;)e[n+1]=e[n],n--;e[n+1]=t}return e}function d(e){const t=Object.create(Array.prototype);return["push","pop","shift","unshift","splice","sort","reverse"].forEach(n=>{const r=Array.prototype[n];t[n]=function(...t){r.apply(this,t),e(n)}}),t}function h(e,t,n){let r=atob(e.split(",")[1]),o=[];for(var a=0;a<r.length;a++)o.push(r.charCodeAt(a));return new File([new Uint8Array(o)],n,{type:t})}function f(e){if(e)return;let t=new Date(e).getUTCDay();0==t?t=6:t-=1;let n=new Date(e).getTime()-864e5*t;return[n,n+5184e5]}function p(e){let t=new Date(date),n=new Number(t.getFullYear()),r=new Number(t.getMonth())+1;return[n+"/"+r+"/01 12:00:00",12==r?new Date(n+1+"/01/01 12:00:00").getTime()-864e5:new Date(n+"/"+(r+1)+"/01 12:00:00").getTime()-864e5]}function m(){let e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!0;for(let r in t)if(e.indexOf(t[r])>0){n=!1;break}return n}function b(e){let t=null;return null!=window.createObjcectURL?t=window.createOjcectURL(e):null!=window.URL?t=window.URL.createObjectURL(e):null!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t}function g(e){return new Promise((t,n)=>{let r;window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),null!=r?(r.open(e.type,baseUrl+e.url,e.async||!0),r.setRequestHeader("Content-type","application/json;charset=UTF-8"),r.send(JSON.stringify(e.data)),r.onreadystatechange=()=>{4==r.readyState&&(200==r.status?t(JSON.parse(r.response)):n(JSON.parse(r)))}):console.log("你的不支持XMLHTTP！")})}function w(e,t){var n={};return function e(n,r){for(let a in n){let c=n[a];Object.defineProperty(r,a,{enumerable:!0,configurable:!0,get:function(){return c},set:function(e){c=e,t()}});try{"Object"==n[a].constructor.name&&e(n[a],r[a])}catch(o){console.log(o)}}}(e,n),n}class y{sketchpad(e){this.sketchpadDom=e.id,this.sketchpadIf=!1;const t=document.getElementById(this.sketchpadDom),n=t.getContext("2d");let r,o,a=!1;t.addEventListener("touchstart",function(e){if(1==e.targetTouches.length){e.preventDefault();var t=e.targetTouches[0];a=!0,c(t.pageX-this.offsetLeft,t.pageY-this.offsetTop,!1)}},!1),t.addEventListener("touchmove",function(e){if(1==e.targetTouches.length){e.preventDefault();var t=e.targetTouches[0];a&&c(t.pageX-this.offsetLeft,t.pageY-this.offsetTop,!0)}},!1),t.addEventListener("touchend",function(e){1==e.targetTouches.length&&(e.preventDefault(),a=!1)},!1),t.onmousedown=function(e){a=!0,c(e.pageX-this.offsetLeft,e.pageY-this.offsetTop,!1)},t.onmousemove=function(e){a&&c(e.pageX-this.offsetLeft,e.pageY-this.offsetTop,!0)},t.onmouseup=function(e){a=!1};let c=(e,t,a)=>{a&&(sketchpadIf=!0,n.strokeStyle="#000",n.lineWidth=4,n.lineJoin="round",n.beginPath(),n.moveTo(r,o),n.lineTo(e,t),n.closePath(),n.stroke()),r=e,o=t}}clearArea(){if(this.sketchpadIf){const e=document.getElementById(this.sketchpadDom).getContext("2d");e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),this.sketchpadIf=!1}}saveImageInfo(){return this.sketchpadIf?document.getElementById(this.sketchpadDom).toDataURL("image/png"):this.sketchpadIf}}const k=e=>{window.onscroll=()=>{(function(){let e=0,t=0;return document.body&&(e=document.body.scrollHeight),document.documentElement&&(t=document.documentElement.scrollHeight),e-t>0?e:t})()<("CSS1Compat"==document.compatMode?document.getElementById("visibleHeight").offsetHeight:document.body.clientHeight)+function(){let e=0,t=0;return document.body&&(e=document.body.scrollTop),document.documentElement&&(t=document.documentElement.scrollTop),(e-t>0?e:t)+1}()&&e()}};function v(e,t){return new Promise((n,r)=>{const o=b(e);var a=new Image;a.src=o,a.onload=()=>{const r=a.width,c=a.height;let s=1;if(r>t||c>t){s=r>c?r/t:c/t;var u=document.createElement("canvas");u.width=r/s,u.height=c/s;var i=u.getContext("2d"),l=new Image;l.src=o,l.onload=function(){i.width=u.width,i.height=u.height,i.drawImage(this,0,0,i.width,i.height);const e=h(u.toDataURL("image/jpeg",.9),"image/jpeg","pipi.jpg");n(e)}}else n(e)}})}class q{constructor(){this.queue=[]}enqueue_before(e){this.queue.push(e)}enqueue_after(e){this.queue.unshift(e)}dequeue_before(){return this.queue.pop()}dequeue_after(){return this.queue.shift()}data_type(){return this.queue.length>0}get_queue(){return this.queue}}class T{constructor(e){this.queue=new q,this.dequeueType=!0,e.lock||!1===e.lock?this.lock=e.lock:this.lock=!0,e.callback?this.callback=e.callback:this.callback=()=>{}}enqueue(e){this.queue.enqueue_after(e),this.lock&&this.dequeue()}dequeue(){let e=()=>{if(this.queue.data_type()&&this.lock){let t=this.queue.dequeue_before();this.callback(t),e()}else this.dequeueType=!0};this.dequeueType&&this.lock&&(this.dequeueType=!1,e())}controller(e){this.lock=e}}n.d(t,"domArea",function(){return o}),n.d(t,"commaSeparated",function(){return a}),n.d(t,"search",function(){return c}),n.d(t,"search1",function(){return s}),n.d(t,"ArrDelete",function(){return u}),n.d(t,"Collocate",function(){return i}),n.d(t,"sort",function(){return l}),n.d(t,"getBlobBydataURI",function(){return h}),n.d(t,"dateWeek",function(){return f}),n.d(t,"dateMonth",function(){return p}),n.d(t,"equipmentJudgment",function(){return m}),n.d(t,"getObjectURL",function(){return b}),n.d(t,"http",function(){return g}),n.d(t,"recursion",function(){return w}),n.d(t,"sketchpad",function(){return y}),n.d(t,"swipingBottom",function(){return k}),n.d(t,"pictureCompression",function(){return v}),n.d(t,"arrayMonitor",function(){return d}),n.d(t,"queue",function(){return q}),n.d(t,"queue_basis",function(){return T})}])),n.exports).queue_basis)({lock:!1,callback:e=>{switch(e.type){case"add":o.addData(e.storeNames,e.data).then(t=>{e.callback({code:!0,result:t})}).catch(t=>{e.callback({code:!1,result:t})});break;case"read":o.read(e.storeNames,e.key).then(t=>{e.callback({code:!0,result:t})}).catch(t=>{e.callback({code:!1,result:t})});break;case"readAll":o.readAll(e.condition,e.storeNames).then(t=>{e.callback({code:!0,result:t})}).catch(t=>{e.callback({code:!1,result:t})});break;case"update":o.update(e.storeNames,e.data).then(t=>{e.callback({code:!0,result:t})}).catch(t=>{e.callback({code:!1,result:t})});break;case"remove":o.remove(e.storeNames,e.key).then(t=>{e.callback({code:!0,result:t})}).catch(t=>{e.callback({code:!1,result:t})});break;case"allLength":o.allLength(e.storeNames).then(t=>{e.callback({code:!0,result:t})}).catch(t=>{e.callback({code:!1,result:t})})}}});r.install=t=>{t.dbData.interface_data_cache={},o=new e({v:t.v,db:t.name,dbData:t.dbData}),o.open().then(e=>{a.controller(!0),a.dequeue()}).catch(e=>{console.log(e)})},r.db=class{constructor(e){this.name=e}add(e){return new Promise((t,n)=>{e.creation_time=(new Date).getTime(),a.enqueue({type:"add",storeNames:this.name,data:e,callback:e=>{e.code?t(e.result):n(e.result)}})})}read(e){return new Promise((t,n)=>{a.enqueue({type:"read",storeNames:this.name,key:e,callback:r=>{r.code?r.result.result&&r.result.result.expiration_time?r.result.result.creation_time+r.result.result.expiration_time>(new Date).getTime()?t(r.result):a.enqueue({type:"remove",storeNames:this.name,key:e,callback:r=>{r.code?a.enqueue({type:"read",storeNames:this.name,key:e,callback:e=>{e.code?t(e.result):n(e.result)}}):n(r.result)}}):t(r.result):n(r.result)}})})}readAll(e){return new Promise((t,n)=>{a.enqueue({type:"readAll",storeNames:this.name,condition:e,callback:e=>{e.code?t(e.result):n(e.result)}})})}update(e){return e.creation_time=(new Date).getTime(),new Promise((t,n)=>{a.enqueue({type:"update",storeNames:this.name,data:e,callback:e=>{e.code?t(e.result):n(e.result)}})})}remove(e){return new Promise((t,n)=>{a.enqueue({type:"remove",storeNames:this.name,key:e,callback:e=>{e.code?t(e.result):n(e.result)}})})}allLength(){return new Promise((e,t)=>{a.enqueue({type:"allLength",storeNames:this.name,callback:n=>{n.code?e(n.result):t(n.result)}})})}};let c=new r.db("interface_data_cache");return r.IFDataCache=(e,t,n)=>async r=>{const o=await c.read(e);if(o.result)return o.result.value;{const o=await t(r);return c.update({key:e,value:o,expiration_time:n}),o}},r});
